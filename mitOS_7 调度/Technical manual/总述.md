### 重点总结

1. **多进程竞争**：
    - 进程数可能超过 CPU 数量，需分时共享。
2. **透明性**：
    - 调度对进程透明，进程无感知地运行。
3. **多路复用**：
    - 通过时间片将进程映射到硬件 CPU，创造虚拟 CPU 错觉。
4. **xv6 实现**：
    - 使用定时器中断和上下文切换实现多路复用（详见第 7 章）。
---

### 在 xv6 中的体现

- **代码**：
    - kernel/trap.c：定时器中断调用 yield()。
    - kernel/proc.c：sched() 和 swtch() 实现上下文切换。
- **机制**：
    - 每个进程运行一段时间（时间片），中断后切换到下一进程。
---
#### 1. **多进程与有限 CPU**

- **描述**：
    - 操作系统可能运行的进程数超过 CPU 数量，需要在进程间分时共享 CPU。
- **类比**：
    - 想象一个只有一个烤箱（CPU）的面包店，但有多个面包师（进程）想烤面包。面包店需要安排每个面包师轮流使用烤箱（分时共享），因为烤箱数量有限。
- **解释**：
    - CPU 是稀缺资源，多进程竞争使用，必须通过调度分配时间。

#### 2. **透明的共享**

- **描述**：
    - 分时共享最好对用户进程透明，即进程无感知地运行。
- **类比**：
    - 每个面包师觉得自己独占烤箱（透明），因为店长（操作系统）在他们烤面包时悄悄切换，让他们感觉无需等待其他面包师。
- **解释**：
    - 操作系统隐藏调度细节，进程以为自己独占 CPU。

#### 3. **多路复用与虚拟 CPU**

- **描述**：
    - 通过将进程多路复用到硬件 CPU 上，每个进程产生拥有虚拟 CPU 的错觉。
- **类比**：
    - 店长给每个面包师分配短暂的烤箱使用时间（时间片），快速轮换（多路复用）。每个面包师感觉自己有专属烤箱（虚拟 CPU），但其实只有一个烤箱在快速切换服务。
- **解释**：
    - 多路复用通过时间分割，让进程共享单一硬件 CPU，模拟独立运行环境。

#### 4. **xv6 的实现**

- **描述**：
    - 本章解释 xv6 如何实现这种多路复用。
- **类比延伸**：
    - 在 xv6 面包店中，店长（调度器）用计时器（定时器中断）每隔几分钟敲铃（触发 yield），让当前面包师暂停（上下文切换），换下一个面包师使用烤箱。这种机制在 kernel/swtch.c 和 kernel/proc.c 中实现。
- **解释**：
    - xv6 使用定时器中断和上下文切换，确保进程轮流执行，透明共享 CPU。

---

### 类比举例：运行三个进程

- **场景**：
    - 单核 CPU（一个烤箱），三个进程 P1、P2、P3（三个面包师）。
- **过程**：
    1. **初始状态**：
        - P1 开始运行，烤面包（占用 CPU）。
    2. **定时器中断**：
        - 几毫秒后，店长敲铃（中断），P1 暂停，保存面包状态（上下文）。
    3. **切换**：
        - P2 上场，继续烤自己的面包，P1 以为自己仍在运行。
    4. **循环**：
        - 再过几毫秒，切换到 P3，然后回到 P1，如此轮转。
- **结果**：
    - 每个面包师感觉自己有专用烤箱（虚拟 CPU），但实际是店长快速切换。